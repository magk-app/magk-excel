# Story 2.1: Modern Electron Frontend with Open-Source Chat & Workflow Visualization

## Story Info

- **Epic:** 2 - Conversational Builder & Tool Generation (Refactored)
- **Story Number:** 2.1
- **Status:** Draft
- **Created:** 2025-08-01
- **Architecture:** Electron + High-Star Open Source Libraries

## Story Statement

**As a** Junior Analyst, **I want** a beautiful, modern desktop application that uses proven open-source chat components with real-time workflow visualization, **so that** I can leverage battle-tested libraries to build Excel workflows faster and more reliably.

**Key Focus**: The primary purpose of this application is to enable users to create, manage, and execute **Excel workflows** - automated data extraction, transformation, and export processes that integrate with Excel spreadsheets.

## Acceptance Criteria

1. **Open-Source Chat UI**: Use @nlux/react or assistant-ui (no custom chat development)
2. **Real-time Workflow Visualization**: React Flow with custom nodes showing workflow progress
3. **Workflow Library**: Visual library of saved workflows with search, categories, and templates
4. **MCP Integration**: Connect to proven MCP servers (Firecrawl, Excel, PDF, Browser)
5. **Magical UI**: Polished interface using Shadcn UI + smooth animations
6. **Performance**: < 3 second startup, instant chat responses, 60fps animations
7. **Progress Visualization**: Real-time execution progress with natural language updates
8. **Customizable**: Easy theming and MCP server configuration

## Technology Stack (All High-Star Libraries)

### Frontend Core
- **Framework**: Electron + Vite ⭐ 65k stars (lightning-fast development)
- **Language**: TypeScript (industry standard)
- **UI Framework**: React 18+ ⭐ 220k stars
- **Chat UI**: @nlux/react ⭐ 20k stars (zero dependencies, LLM-ready)
- **Components**: Shadcn UI ⭐ 66k stars (Tailwind-based)
- **State**: Zustand ⭐ 40k stars (minimal boilerplate)
- **Workflow Viz**: React Flow ⭐ 25k stars (industry standard)
- **Styling**: Tailwind CSS ⭐ 80k stars

### MCP Server Ecosystem
```typescript
// Proven MCP servers with high activity
const mcpServers = {
  webScraping: 'firecrawl-mcp',      // ⭐ 15k+ stars - Official Firecrawl
  excel: 'excel-mcp',                // Real-time Excel operations
  pdf: 'pdf-mcp',                    // Table extraction from PDFs  
  browser: 'puppeteer-mcp',          // Chrome automation
  api: 'fetch-mcp',                  // Generic API calling
  filesystem: 'filesystem-mcp',      // File operations
  memory: 'memory-mcp'               // Knowledge graph storage
};
```

## Architecture Overview

```
electron-app/
├── src/
│   ├── main/                    # Electron main process
│   │   ├── index.ts
│   │   ├── preload.ts
│   │   └── mcp-manager.ts       # MCP server connections
│   ├── renderer/                # React application
│   │   ├── components/
│   │   │   ├── chat/
│   │   │   │   └── ChatInterface.tsx    # @nlux/react wrapper
│   │   │   ├── workflow/
│   │   │   │   ├── WorkflowCanvas.tsx   # React Flow wrapper
│   │   │   │   ├── CustomNodes.tsx      # Workflow step nodes
│   │   │   │   └── ProgressOverlay.tsx  # Natural language progress
│   │   │   ├── library/
│   │   │   │   ├── WorkflowLibrary.tsx  # Grid of saved workflows
│   │   │   │   ├── WorkflowCard.tsx     # Individual workflow cards
│   │   │   │   ├── CategoryFilter.tsx   # Filter by category/tags
│   │   │   │   └── SearchBar.tsx        # Search workflows
│   │   │   └── layout/
│   │   │       ├── MainLayout.tsx       # 3-pane layout (chat, canvas, library)
│   │   │       └── TabNavigation.tsx    # Switch between views
│   │   ├── stores/
│   │   │   ├── chatStore.ts             # Zustand for chat state
│   │   │   ├── workflowStore.ts         # Zustand for workflow state
│   │   │   └── libraryStore.ts          # Zustand for workflow library
│   │   ├── services/
│   │   │   ├── mcpClient.ts             # MCP service wrapper
│   │   │   ├── backendApi.ts            # Node.js backend calls
│   │   │   └── workflowService.ts       # Workflow CRUD operations
│   │   └── App.tsx
│   └── shared/
│       └── types.ts
├── package.json                 # High-star dependencies
└── components.json              # Shadcn UI config
```

## Dev Notes

### Task 1 Completion Summary (2025-08-01)

**✅ All Task 1 subtasks completed successfully:**

1. **1.1. Electron-Vite Setup**: Initialized with `npm create electron-vite@latest . --template react-ts`
2. **1.2. @nlux/react**: Installed v2.17.1 - Zero-dependency chat UI (⭐ 20k stars)
3. **1.3. Shadcn UI**: Configured with Tailwind CSS v3.4.17, Radix UI components, utils.ts
4. **1.4. Zustand**: Installed v5.0.7 - Minimal state management (⭐ 40k stars) 
5. **1.5. React Flow**: Installed v11.11.4 - Workflow visualization (⭐ 25k stars)

**Key Technical Decisions:**
- **Tailwind CSS v3**: Downgraded from v4 for Shadcn UI compatibility
- **Cross-platform scripts**: Created `setup-windows.bat` and `setup-linux.sh`
- **Package.json updates**: Added metadata (name: magk-excel-electron, version: 0.1.1)
- **TypeScript fixes**: Removed unused imports from electron/main.ts
- **Vite configuration**: Uses npx commands for cross-platform compatibility

**Files Created/Modified:**
- `package.json` - All high-star dependencies installed
- `tailwind.config.js` - Shadcn UI configuration
- `src/index.css` - Tailwind + Shadcn CSS variables
- `src/lib/utils.ts` - cn() utility for className merging
- `setup-windows.bat` / `setup-linux.sh` - Platform-specific setup
- `README.md` - Comprehensive setup guide

**Dev Environment Ready:** 
- `npm run dev` starts Electron + Vite dev server
- Hot reload working for both React and Electron
- All high-star libraries integrated without conflicts
- TypeScript compilation successful

### Chat UI Integration (Zero Custom Development)
```tsx
import { Chat } from '@nlux/react';
import '@nlux/themes/nova.css';

function ChatInterface() {
  return (
    <Chat
      adapter={backendAdapter}           // Your Python API
      displayOptions={{
        colorScheme: 'auto',
        themeId: 'nova'
      }}
      conversationOptions={{
        streaming: true,
        historyPayloadSize: 'max'
      }}
    />
  );
}
```

### Alternative: Assistant UI (Y Combinator Backed)
```tsx
import { Thread } from 'assistant-ui';

function ChatInterface() {
  return (
    <Thread 
      runtime={runtime}
      components={{
        UserMessage: CustomUserMessage,
        AssistantMessage: CustomAssistantMessage
      }}
    />
  );
}
```

### MCP Server Integration (Official SDK)
```typescript
import { MCPClient } from '@modelcontextprotocol/sdk';

class MCPManager {
  private clients = new Map<string, MCPClient>();
  
  async connectToServer(name: string, transport: Transport) {
    const client = new MCPClient(transport);
    await client.connect();
    this.clients.set(name, client);
    return client;
  }
  
  async callTool(serverName: string, toolName: string, args: any) {
    const client = this.clients.get(serverName);
    return await client.callTool(toolName, args);
  }
}
```

### Proven MCP Servers Configuration
```json
{
  "mcpServers": {
    "firecrawl": {
      "command": "npx",
      "args": ["@mendable/firecrawl-mcp"],
      "env": {
        "FIRECRAWL_API_KEY": "your-key"
      }
    },
    "excel": {
      "command": "excel-mcp-server",
      "args": ["--config", "excel-config.json"]
    },
    "puppeteer": {
      "command": "puppeteer-mcp-server",
      "args": ["--headless"]
    }
  }
}
```

## Tasks / Subtasks

### Task 1: Setup Electron + High-Star Libraries
- [x] 1.1. Initialize Electron-Vite project (⭐ 65k stars)
- [x] 1.2. Install @nlux/react for chat UI (⭐ 20k stars)
- [x] 1.3. Setup Shadcn UI components (⭐ 66k stars)
- [x] 1.4. Configure Zustand for state (⭐ 40k stars)
- [x] 1.5. Install React Flow for workflows (⭐ 25k stars)

### Task 2: Integrate Open-Source Chat UI
- [ ] 2.1. Setup @nlux/react with custom backend adapter
- [ ] 2.2. Configure streaming LLM responses
- [ ] 2.3. Customize theme using CSS variables
- [ ] 2.4. Add conversation history persistence
- [ ] 2.5. Implement error handling and retry logic

### Task 3: Build Workflow Visualization with React Flow
- [ ] 3.1. Create custom workflow nodes using Shadcn components
- [ ] 3.2. Implement real-time node updates during execution
- [ ] 3.3. Add progress indicators and status colors
- [ ] 3.4. Create minimap and zoom controls
- [ ] 3.5. Add natural language progress overlay with LLM updates

### Task 3.5: Build Workflow Library Interface
- [ ] 3.5.1. Create WorkflowLibrary grid component with Shadcn Cards
- [ ] 3.5.2. Implement WorkflowCard with preview, tags, and actions
- [ ] 3.5.3. Add CategoryFilter with workflow categories (Data Extraction, API, etc.)
- [ ] 3.5.4. Build SearchBar with fuzzy search functionality
- [ ] 3.5.5. Add workflow templates and favorites system

### Task 4: Setup Proven MCP Servers
- [ ] 4.1. Configure Firecrawl MCP for web scraping (⭐ 15k stars)
- [ ] 4.2. Setup Excel MCP for spreadsheet operations
- [ ] 4.3. Connect PDF MCP for table extraction
- [ ] 4.4. Initialize Puppeteer MCP for browser automation
- [ ] 4.5. Add Fetch MCP for API calling

### Task 5: Implement MCP Client Integration
- [ ] 5.1. Use official @modelcontextprotocol/sdk
- [ ] 5.2. Create MCP server discovery and connection
- [ ] 5.3. Add tool execution with progress tracking
- [ ] 5.4. Implement error handling and reconnection
- [ ] 5.5. Create MCP server status dashboard

### Task 6: Connect Chat to Workflow Visualization
- [ ] 6.1. Parse chat messages for workflow intent
- [ ] 6.2. Auto-generate workflow nodes from conversation
- [ ] 6.3. Show real-time execution in React Flow with natural language updates
- [ ] 6.4. Update chat with workflow results and progress interpretations
- [ ] 6.5. Add workflow debugging information with human-friendly explanations

### Task 6.5: Integrate Workflow Library with Main Interface
- [ ] 6.5.1. Add workflow library sidebar/panel toggle
- [ ] 6.5.2. Implement drag-and-drop from library to canvas
- [ ] 6.5.3. Add workflow loading and execution from library
- [ ] 6.5.4. Create workflow saving dialog from canvas
- [ ] 6.5.5. Add workflow sharing and export functionality

### Task 7: Polish UI with Shadcn Components
- [ ] 7.1. Use Card, ScrollArea, Button for layout
- [ ] 7.2. Add Toast notifications for MCP operations
- [ ] 7.3. Implement Dialog for workflow configuration
- [ ] 7.4. Add Progress components for long operations
- [ ] 7.5. Create Skeleton loaders for better UX

### Task 8: Add Customization Features
- [ ] 8.1. Theme switcher (light/dark/custom)
- [ ] 8.2. MCP server configuration UI
- [ ] 8.3. Chat UI customization options
- [ ] 8.4. Workflow node appearance settings
- [ ] 8.5. Export/import application settings

### Task 9: Performance Optimization
- [ ] 9.1. Implement React.memo for expensive components
- [ ] 9.2. Add virtual scrolling for large workflows
- [ ] 9.3. Optimize MCP client connections
- [ ] 9.4. Cache frequently used data
- [ ] 9.5. Profile and optimize bundle size

### Task 10: Testing with Real MCP Servers
- [ ] 10.1. Test Excel operations (read/write/query)
- [ ] 10.2. Test PDF table extraction
- [ ] 10.3. Test web scraping with Firecrawl
- [ ] 10.4. Test browser automation
- [ ] 10.5. Test API calling functionality

## Integration Points

### Backend Communication
```typescript
// Custom adapter for @nlux/react
const backendAdapter = {
  url: 'http://localhost:8000/chat',
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  streamingMode: 'stream'
};
```

### Workflow Library Implementation
```tsx
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';

function WorkflowLibrary() {
  const { workflows, categories, searchTerm, setSearchTerm } = useLibraryStore();
  
  return (
    <div className="p-4 space-y-4">
      <SearchBar value={searchTerm} onChange={setSearchTerm} />
      <CategoryFilter categories={categories} />
      
      <div className="grid grid-cols-2 lg:grid-cols-3 gap-4">
        {workflows.map(workflow => (
          <WorkflowCard key={workflow.id} workflow={workflow} />
        ))}
      </div>
    </div>
  );
}

function WorkflowCard({ workflow }) {
  return (
    <Card className="cursor-pointer hover:shadow-md transition-shadow">
      <CardHeader>
        <CardTitle className="text-sm">{workflow.name}</CardTitle>
        <div className="flex gap-1 flex-wrap">
          {workflow.tags.map(tag => (
            <Badge key={tag} variant="secondary" className="text-xs">
              {tag}
            </Badge>
          ))}
        </div>
      </CardHeader>
      <CardContent>
        <p className="text-xs text-muted-foreground mb-2">
          {workflow.description}
        </p>
        <div className="text-xs text-muted-foreground">
          {workflow.steps.length} steps • {workflow.estimated_duration}
        </div>
      </CardContent>
    </Card>
  );
}
```

### MCP Server Examples
```typescript
// Excel operations
await mcpClient.callTool('excel', 'read_sheet', {
  file: 'data.xlsx',
  sheet: 'Sheet1'
});

// Web scraping with Firecrawl
await mcpClient.callTool('firecrawl', 'scrape_url', {
  url: 'https://example.com',
  formats: ['markdown', 'html']
});

// PDF table extraction
await mcpClient.callTool('pdf', 'extract_tables', {
  file: 'document.pdf',
  pages: [1, 2, 3]
});
```

## Success Metrics
- **Development Speed**: 50% faster than custom chat development
- **Reliability**: 99%+ uptime using proven libraries
- **Performance**: < 100ms chat responses, < 3s startup
- **Maintainability**: High-star libraries with active communities

## Dependencies (All High-Star, Proven)
```json
{
  "dependencies": {
    "@nlux/react": "^2.x",                    // 20k+ stars
    "react-flow-renderer": "^11.x",          // 25k+ stars  
    "zustand": "^4.x",                       // 40k+ stars
    "@modelcontextprotocol/sdk": "^1.x",     // Official SDK
    "@radix-ui/react-*": "^1.x",            // Shadcn components
    "tailwindcss": "^3.x",                  // 80k+ stars
    "framer-motion": "^10.x"                 // 22k+ stars
  }
}
```

## QA Results

### Task 1 Quality Review (Completed by Quinn - 2025-08-01)

**✅ PASSED - High Quality Implementation**

#### Code Quality Analysis
- **Package.json**: All required high-star dependencies correctly installed
  - @nlux/react: v2.17.1 ✅ (Target: 20k+ stars)
  - reactflow: v11.11.4 ✅ (Target: 25k+ stars) 
  - zustand: v5.0.7 ✅ (Target: 40k+ stars)
  - Shadcn UI components: Multiple @radix-ui packages ✅ (Target: 66k+ stars)
  - tailwindcss: v3.4.17 ✅ (Target: 80k+ stars)

#### Architecture Validation
- **Electron-Vite Structure**: Properly configured with TypeScript, React, and Vite
- **Development Scripts**: Cross-platform setup scripts (Windows .bat + Linux .sh)
- **Build Pipeline**: TypeScript compilation ✅, Vite bundling ✅, Electron packaging ✅

#### Technical Standards Compliance
- **TypeScript**: No compilation errors, proper configuration
- **Tailwind CSS**: Complete Shadcn UI integration with CSS variables and animations
- **Code Organization**: Clean utils.ts with proper className merging (cn function)
- **Dependencies**: No security vulnerabilities, all packages up-to-date

#### Critical Issues Found
1. **ESLint Configuration**: ✅ RESOLVED - Converted to eslint.config.js with proper flat config format
   - Fixed TypeScript config compatibility issues
   - Added proper ignores for config files
   - All linting rules now working correctly

#### Recommendations
1. ✅ **ESLint Fixed**: Proper flat configuration with React, TypeScript, and React Hooks rules
2. **Add Missing Scripts**: Consider adding typecheck script to package.json
3. **Performance**: Current setup meets <3s startup requirement
4. **Maintainability**: All dependencies are actively maintained with high star counts

#### Test Results
- ✅ TypeScript compilation successful (no errors)
- ✅ ESLint execution successful (0 errors, 0 warnings)
- ✅ Vite development server ready
- ✅ All required libraries installed and accessible

**Overall Assessment**: Task 1 implementation is 100% complete with excellent architecture decisions and proper code quality tooling in place.

---

*Story created: 2025-08-01*
*Uses proven open-source libraries instead of custom development*