# Story 2.1: Basic Chat Interface

## Story Info

- **Epic:** 2 - Conversational Builder & Tool Generation  
- **Story Number:** 2.1  
- **Status:** Draft  
- **Created:** 2025-07-30  

## Story Statement

**As a** Junior Analyst, **I want** a simple chat window to type my request to MAGK, **so that** I can begin creating an automation tool.

## Acceptance Criteria

1. A basic desktop GUI window is created.
2. User can send messages.
3. Conversation is displayed.
4. The AI can ask clarifying questions.

## Dev Notes

### Previous Story Insights
From Story 1.3 (Excel Generation and Manipulation):
- Project structure is established with `apps/client/` for desktop client application
- Backend infrastructure is complete with web extraction, PDF extraction, and Excel generation modules
- Error handling pattern established using try/except blocks with CloudWatch logging
- Testing strategy uses pytest with comprehensive mocking for external dependencies
- API endpoint `/execute-workflow` is functional and ready for client integration

### Data Models
**WorkflowConfig**: This story will work with the WorkflowConfig data model which includes:
- `sourceType`: Can be 'web', 'pdf', or 'excel' (from previous stories)
- `sourceUri`: URL or file path to the data source
- `dataIdentifier`: String to identify the specific table or data
- The chat interface will guide users to build WorkflowConfig objects through conversation
[Source: architecture/data-models.md#WorkflowConfig]

### API Specifications
This story will integrate with the existing `/execute-workflow` endpoint:
- **Purpose**: To trigger data extraction and Excel generation workflows
- **Request Body**: The WorkflowConfig object in JSON format
- **Response**: `{ "outputUrl": "<https://s3>..." }` (A pre-signed URL to download the generated Excel file)
- The chat interface will construct and send these API requests based on user conversations
[Source: architecture/api-specification.md#POST /execute-workflow]

### Component Specifications
**Desktop Client Technology**: PyQt 6.x will be used for the desktop GUI application
- **Rationale**: Cross-platform GUI framework with Python integration
- **Location**: This module will be part of the desktop client in the apps/client directory
- **Integration**: Will communicate with the serverless backend via HTTP requests
[Source: architecture/tech-stack.md#Frontend]

### File Locations
Based on the project structure established in previous stories:
- **Desktop Client Main**: `apps/client/src/main.py`
- **Chat Interface Module**: `apps/client/src/ui/chat_window.py`
- **API Client Module**: `apps/client/src/api/backend_client.py`
- **Tests**: `apps/client/tests/test_chat_window.py`
[Source: architecture/unified-project-structure.md#Project Structure]

### Testing Requirements
**Unit Testing**: 
- Automated unit tests using `pytest` will be implemented for the chat interface components
- Tests will be located in the client tests directory
- Primary focus on UI component behavior and API integration
- Mock backend responses for comprehensive testing scenarios
[Source: architecture/testing-strategy.md#Unit Testing]

### Technical Constraints
**Python Version**: Python 3.10.x is required for consistency with the backend
**Desktop Platform**: Windows desktop application (primary target platform)
**Error Handling**: Use standard Python try/except blocks with user-friendly error messages
**UI Framework**: PyQt 6.x for consistent cross-platform desktop experience
[Source: architecture/tech-stack.md#Frontend Language, architecture/error-handling-strategy.md#Client-Side]

### Security and Performance Considerations
**HTTPS Communication**: All communication with backend must be over HTTPS
**User Input Validation**: Sanitize and validate all user inputs before sending to backend
**Responsive UI**: Keep UI responsive during backend communication with proper threading
**Error Handling**: Graceful handling of network failures and backend errors
[Source: architecture/security-and-performance.md#Security, architecture/error-handling-strategy.md#Client-Side]

## Tasks / Subtasks

### Task 1: Set up desktop client project structure (AC: 1)
- [ ] 1.1. Create `apps/client/` directory structure with src/, tests/, and requirements.txt
- [ ] 1.2. Set up PyQt 6.x dependencies in `apps/client/requirements.txt`
- [ ] 1.3. Create basic project entry point in `apps/client/src/main.py`
- [ ] 1.4. Set up pytest configuration for client-side testing
- [ ] 1.5. Create `.gitignore` entries for PyQt and Python client artifacts

### Task 2: Implement basic chat window GUI (AC: 1, 3)
- [ ] 2.1. Create `apps/client/src/ui/chat_window.py` with PyQt 6 main window
- [ ] 2.2. Design chat interface layout with message display area and input field
- [ ] 2.3. Implement message display functionality with scrollable conversation history
- [ ] 2.4. Add basic styling and user-friendly appearance
- [ ] 2.5. Handle window resize and basic GUI events

### Task 3: Implement message sending functionality (AC: 2)
- [ ] 3.1. Create message input field with send button and Enter key support
- [ ] 3.2. Implement message validation and basic input sanitization
- [ ] 3.3. Add messages to conversation display in real-time
- [ ] 3.4. Clear input field after message is sent
- [ ] 3.5. Add basic error handling for empty or invalid messages

### Task 4: Create backend API client integration (AC: 4)
- [ ] 4.1. Create `apps/client/src/api/backend_client.py` for HTTP communication
- [ ] 4.2. Implement async communication to keep UI responsive
- [ ] 4.3. Add proper error handling for network failures and timeouts
- [ ] 4.4. Implement basic authentication/authorization if required
- [ ] 4.5. Add logging for debugging API communication issues

### Task 5: Implement AI conversation flow (AC: 4)
- [ ] 5.1. Design conversation state management for multi-turn dialogue
- [ ] 5.2. Implement logic to send user messages to backend AI service
- [ ] 5.3. Display AI responses in the conversation with proper formatting
- [ ] 5.4. Add support for clarifying questions from AI
- [ ] 5.5. Implement conversation context tracking for workflow building

### Task 6: Add workflow configuration building (Integration with existing backend)
- [ ] 6.1. Implement logic to extract WorkflowConfig parameters from conversation
- [ ] 6.2. Guide user through source type selection (web, pdf, excel)
- [ ] 6.3. Collect source URI and data identifier through natural conversation
- [ ] 6.4. Validate collected parameters before sending to backend
- [ ] 6.5. Integrate with existing `/execute-workflow` endpoint

### Task 7: Unit testing implementation
- [ ] 7.1. Create `apps/client/tests/test_chat_window.py` test file
- [ ] 7.2. Write unit tests for GUI component initialization and layout
- [ ] 7.3. Write unit tests for message sending and display functionality
- [ ] 7.4. Write unit tests for API client communication with mocked responses
- [ ] 7.5. Write unit tests for conversation state management
- [ ] 7.6. Write unit tests for error handling scenarios
- [ ] 7.7. Create mock fixtures for backend API responses
- [ ] 7.8. Ensure all tests pass using pytest

### Task 8: Desktop application packaging and deployment
- [ ] 8.1. Research PyQt application packaging options (PyInstaller, cx_Freeze)
- [ ] 8.2. Create application build scripts for Windows executable generation
- [ ] 8.3. Test packaged application on clean Windows environment
- [ ] 8.4. Add application icon and basic branding elements
- [ ] 8.5. Create basic installation/setup documentation

## Project Structure Notes

The current project structure aligns with the defined architecture. The desktop client application will be created in the `apps/client/` directory as specified in the unified project structure guide. This maintains separation between the serverless backend (`apps/server/`) and the desktop client, allowing for independent development and deployment. No structural conflicts identified.

## Dev Agent Record

### Agent Model Used
*To be filled in by the Dev Agent during implementation*

### Implementation Notes
*To be filled in by the Dev Agent during implementation*

### Completion Notes  
*To be filled in by the Dev Agent upon story completion*

### Debug Log References
*References to debug log entries will be added here during implementation*

## File List
*Files created/modified during story implementation:*
- [ ] To be updated during implementation

## Change Log
- 2025-07-30: Created story 2.1 based on Epic 2 requirements and architecture documentation

---
*Story created: 2025-07-30*